;18-649 Fall 2013
;Group 18
;Yi Huo (yhuo)
;Mustafa Bilgen (mbilgen)
;Sairam Krishnan (sbkrishn)
;Abhijit Lele(alele)
;
;Integration Test for SD 2b - Tests 

#INCLUDE defines.mf

;Setup preconditions
;at floor 1 
0s I AT_FLOOR_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
0s I AT_FLOOR_PERIOD N AT_FLOOR_[1][BACK]_CAN_ID AtFloor 1 BACK = true
0s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 1 UP BOTH
0s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0s I DISPATCHER_PERIOD N DESIRED_DWELL_[FRONT]_CAN_ID DesiredDwell FRONT = 2
0s I DISPATCHER_PERIOD N DESIRED_DWELL_[BACK]_CAN_ID DesiredDwell BACK = 2
0s I WEIGHT_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 200

;make sure doors are openning
0.51s A F DoorMotor FRONT LEFT : command == OPEN
0.51s A F DoorMotor FRONT RIGHT : command == OPEN
0.51s A F DoorMotor BACK LEFT : command == OPEN
0.51s A F DoorMotor BACK RIGHT : command == OPEN

;doors are fully open
1.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true
1.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][RIGHT]_CAN_ID DoorOpened FRONT RIGHT = true
1.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[BACK][LEFT]_CAN_ID DoorOpened BACK LEFT = true
1.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[BACK][RIGHT]_CAN_ID DoorOpened BACK RIGHT = true

;make sure doors are fully open and not moving
1.81s A F DoorMotor FRONT LEFT : command == STOP
1.81s A F DoorMotor FRONT RIGHT : command == STOP
1.81s A F DoorMotor BACK LEFT : command == STOP
1.81s A F DoorMotor BACK RIGHT : command == STOP

;#arc '1a/1b'
3.81s A F DoorMotor FRONT LEFT : command == CLOSE
3.81s A F DoorMotor FRONT RIGHT : command == CLOSE
3.81s A F DoorMotor BACK LEFT : command == CLOSE
3.81s A F DoorMotor BACK RIGHT : command == CLOSE

;#arc '2/3a'
4.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = true
4.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][RIGHT]_CAN_ID DoorReversal FRONT RIGHT = true
4.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[BACK][LEFT]_CAN_ID DoorReversal BACK LEFT = true
4.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[BACK][RIGHT]_CAN_ID DoorReversal BACK RIGHT = true

7.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = true
7.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][RIGHT]_CAN_ID DoorReversal FRONT RIGHT = true
7.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[BACK][LEFT]_CAN_ID DoorReversal BACK LEFT = true
7.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[BACK][RIGHT]_CAN_ID DoorReversal BACK RIGHT = true

;#arc '3b'
7.21s A F DoorMotor FRONT LEFT : command == NUDGE
7.21s A F DoorMotor FRONT RIGHT : command == NUDGE
7.21s A F DoorMotor BACK LEFT : command == NUDGE
7.21s A F DoorMotor BACK RIGHT : command == NUDGE

;change desired floor
8.20s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 2 UP BACK

;#arc '3c'
8.30s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
8.30s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true 
8.30s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
8.30s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true 

;#arc '3d/4'
;elevator stops and passenger gets out
10.11s A F DoorMotor FRONT LEFT : command == STOP
10.11s A F DoorMotor FRONT RIGHT : command == STOP
10.11s A F DoorMotor BACK LEFT : command == STOP
10.11s A F DoorMotor BACK RIGHT : command == STOP